import{aO as b,b as C,c as q,r as R,o as h,e as U,f as Y,g as o,w as n,h as e,aj as Z,ak as ee,i as c,t as f,F as le,s as oe,q as te,aP as ae,E as re,j as se,A as ne,B as ie}from"./index-e0dafb85.js";import{E as de}from"./el-dialog-75a77bcb.js";import{E as me}from"./el-switch-2d4ff51c.js";import{E as ue}from"./el-radio-67ddd841.js";import{E as pe,a as ce}from"./el-form-item-01002221.js";import{a as fe}from"./app-role-6e49f3d8.js";import{l as be}from"./app-dept-a4302018.js";import{u as _e}from"./use-table-handlers-14b38a89.js";const ge=i=>b({url:"app/user/listPage",method:"post",data:i}),he=i=>b({url:"app/user/save",method:"post",data:i}),Ve=i=>{const{id:u}=i;return delete i.id,b({url:`app/user/update/${u}`,method:"post",data:i})},Ee=i=>b({url:"app/user/delete",method:"post",data:i}),ve={class:"main-body"},Ie={class:"toolbar"},Oe={__name:"User",setup(i){const u=C({name:""}),a=C({id:"",name:"",deptId:"",email:"",mobile:"",roleIds:[],status:!0}),{t:l,isEdit:_,dialogVisible:g,tableRef:B,formLoading:O,formRef:V,doSearch:S,doAdd:T,doEdit:x,doSubmit:D,doRemove:W,doClose:E}=_e(a),$=q(()=>[{type:"selection"},{prop:"id",label:l("thead.ID"),minWidth:50},{prop:"name",label:l("thead.username"),minWidth:120},{prop:"deptName",label:l("thead.dept"),minWidth:120,showOverflowTooltip:!0},{prop:"roleNames",label:l("thead.role"),minWidth:100,showOverflowTooltip:!0},{prop:"email",label:l("thead.email"),minWidth:120,showOverflowTooltip:!0},{prop:"mobile",label:l("thead.mobile"),minWidth:100},{prop:"status",label:l("thead.status"),minWidth:70,formatter:t=>t.status?l("status.on"):l("status.off")}]),v=(t,r,m)=>{!a.email&&!a.mobile&&m(new Error(l("form.emailOrMobile"))),(!a.mobile||!a.email)&&V.value.clearValidate(t.field==="email"?"mobile":"email"),m()},F=q(()=>({name:[{required:!0,message:l("form.usernameHolder"),trigger:["change","blur"]}],deptId:[{required:!0,message:l("form.deptRequired"),trigger:["change","blur"]}],email:[{required:!0,message:l("form.emailError"),trigger:["change","blur"]},{validator:v,message:l("form.emailOrMobile"),trigger:["change","blur"]}],mobile:[{required:!0,message:l("form.mobileError"),trigger:["change","blur"]},{validator:v,message:l("form.emailOrMobile"),trigger:["change","blur"]}],roleIds:[{required:!0,message:l("form.roleIdsRequired"),trigger:["change","blur"]}]})),I=R([]),y=R([]);function w(){N(),P()}function N(){be().then(t=>{I.value=t.data})}function P(){fe().then(t=>{y.value=t.data})}const H=t=>{w(),T(t)},M=t=>{w(),x(t),a.roleIds=t.roleIds.split(",").map(r=>+r),a.status=!!t.status};function j(t,r){W(Ee,t,r)}function A(){D({save:he,update:Ve,getParams:L},t=>{_.value||ae.alert(`${l("tips.success")}${l("form.username")}: ${t.data.name},${l("form.password")}: ${t.data.password}`,l("tips.title"),{confirmButtonText:l("action.confirm")})})}function L(){const t={...a};return _.value||delete t.id,t.roleIds=a.roleIds.join(","),t}return(t,r)=>{const m=re,d=ce,p=se,k=pe,z=ee,G=ue,J=ne,K=ie,Q=me,X=de;return h(),U("div",ve,[Y("div",Ie,[o(k,{inline:!0,model:e(u)},{default:n(()=>[o(d,null,{default:n(()=>[o(m,{modelValue:e(u).name,"onUpdate:modelValue":r[0]||(r[0]=s=>e(u).name=s),placeholder:e(l)("thead.username")},null,8,["modelValue","placeholder"])]),_:1}),o(d,null,{default:n(()=>[o(p,{type:"primary",icon:"search",onClick:e(S)},{default:n(()=>[c(f(e(l)("action.search")),1)]),_:1},8,["onClick"])]),_:1}),o(d,null,{default:n(()=>[o(p,{type:"primary",icon:"plus",onClick:H},{default:n(()=>[c(f(e(l)("action.add")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),o(z,{ref_key:"tableRef",ref:B,"get-page":e(ge),filters:e(u),columns:e($),onHandleEdit:M,onHandleDelete:j},null,8,["get-page","filters","columns"]),o(X,{title:e(_)?e(l)("action.edit"):e(l)("action.add"),modelValue:e(g),"onUpdate:modelValue":r[7]||(r[7]=s=>Z(g)?g.value=s:null),draggable:"",width:"50%","close-on-click-modal":!1,onClose:e(E)},{footer:n(()=>[o(p,{onClick:e(E),type:"primary"},{default:n(()=>[c(f(e(l)("action.cancel")),1)]),_:1},8,["onClick"]),o(p,{type:"primary",onClick:A,loading:e(O)},{default:n(()=>[c(f(e(l)("action.submit")),1)]),_:1},8,["loading"])]),default:n(()=>[o(k,{ref_key:"formRef",ref:V,model:e(a),"label-width":"80px",rules:e(F),"label-position":"right"},{default:n(()=>[o(d,{label:e(l)("form.username"),prop:"name"},{default:n(()=>[o(m,{modelValue:e(a).name,"onUpdate:modelValue":r[1]||(r[1]=s=>e(a).name=s)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,{label:e(l)("form.dept"),prop:"deptId"},{default:n(()=>[o(G,{modelValue:e(a).deptId,"onUpdate:modelValue":r[2]||(r[2]=s=>e(a).deptId=s),props:{label:"name",value:"id",checkStrictly:!0,emitPath:!1},options:e(I),clearable:"",filterable:"",class:"w100p"},null,8,["modelValue","options"])]),_:1},8,["label"]),o(d,{label:e(l)("form.email"),prop:"email"},{default:n(()=>[o(m,{modelValue:e(a).email,"onUpdate:modelValue":r[3]||(r[3]=s=>e(a).email=s)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,{label:e(l)("form.mobile"),prop:"mobile"},{default:n(()=>[o(m,{modelValue:e(a).mobile,"onUpdate:modelValue":r[4]||(r[4]=s=>e(a).mobile=s)},null,8,["modelValue"])]),_:1},8,["label"]),o(d,{label:e(l)("form.role"),prop:"roleIds"},{default:n(()=>[o(K,{modelValue:e(a).roleIds,"onUpdate:modelValue":r[5]||(r[5]=s=>e(a).roleIds=s),multiple:"",placeholder:e(l)("form.choose"),style:{width:"100%"}},{default:n(()=>[(h(!0),U(le,null,oe(e(y),s=>(h(),te(J,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(d,{label:e(l)("status.on")},{default:n(()=>[o(Q,{modelValue:e(a).status,"onUpdate:modelValue":r[6]||(r[6]=s=>e(a).status=s)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])])}}};export{Oe as default};
